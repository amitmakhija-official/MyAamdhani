@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
@*<link href="~/Content/jsgrid.css" rel="stylesheet" />*@

<div class="page-body">
    <!-- Container-fluid starts-->
    <div class="container-fluid">
        <div class="page-header">
            <div class="row">
                <div class="col-lg-4">
                    <div class="page-header-left">
                        <input type="text" id="CategorySearch" class="form-control" placeholder="Search..." style="max-width:100%;border-radius:10px" />
                        <span class="input-group-btn">
                            <button class="btn" style="color:white;padding-right:10px;padding-left:10px;border-radius:10px" onclick="searchByCategory()">
                                <i class="search-icon-black"></i>
                            </button>
                        </span>
                    </div>
                </div>
                <div class="col-lg-4">
                </div>
                <div class="col-lg-4">
                    <a class="btn-primary btn pull-right" href="@Url.Action("Manage", "Category",new { Id = Guid.Parse("00000000-0000-0000-0000-000000000000") })">Add New Category</a>
                    @*<ol class="breadcrumb pull-right">
                            <li class="breadcrumb-item"><a href="index.html"><i data-feather="home"></i></a></li>
                            <li class="breadcrumb-item">Digital</li>
                            <li class="breadcrumb-item active">Product List</li>
                        </ol>*@
                </div>
            </div>
        </div>
    </div>
    <!-- Container-fluid Ends-->
    <!-- Container-fluid starts-->
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-12">
                <div class="card">
                    @*<div class="card-header">

                        </div>*@

                    <div class="card-body">

                        <div id="divCategory" class="table-responsive">

                        </div>
                        <br />
                        <div id="divCategoryPaging" style="padding:0px 10px 10px 0px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Container-fluid Ends-->
    </div>
</div>

<style type="text/css">
    .footable tbody tr td {
        vertical-align: top !important;
    }
</style>

@section Scripts{
    <script type="text/javascript">
        var searchOrder = '';
        var searchComp = '';
        $(document).ready(function () {

            $('.dvloader').fadeIn();
            var success = '@TempData["Success"]';
            var msg = '@TempData["Msg"]';
            if (success == 'True') { Toastrtimer(true, msg); }
            else if (success == 'False') { Toastrtimer(false, msg); }
            if ($('#CategorySearch').val() == '') {
                SearchFilter(1, '')
            }
            else if ($('#CategorySearch').val() != '') {
                SearchFilter(1, $('#CategorySearch').val())
            }
            $('th.footable-sortable').click(function (e) {
                if ($(this).hasClass('footable-sorted')) // asc
                {
                    searchOrder = 'desc'
                } else {
                    searchOrder = 'asc'
                }
                searchComp = $(this)[0].id;
            });
            $('.dvloader').fadeOut();
        });

        function DeleteCancel() {
            $('#Mdl_DeleteMAD').modal('hide');
        }

        function deleteCategory(ref, CategoryId) {
            var Category = $(ref).parent().parent().children()[2].innerText;
            $('#hdnDeleteId').val(CategoryId);
            $('#dynamic_delbody').html("Are you sure you want to delete '" + Category + "' Category?");
            $('#Mdl_DeleteMAD').modal('show');
        }

        function DeleteOk() {
            var delId = $('#hdnDeleteId').val();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteCategory","Category")',
                data: "CategoryId=" + delId,
                success: function (data) {
                    if (data.success == true) {
                        SearchFilter(1, '');
                    }
                    window.location.href = '@Url.Action("Index","Category")'
                    $('.iCheck-helper').iCheck({
                        checkboxClass: 'icheckbox_flat-red',
                        radioClass: 'iradio_flat-red'
                    });
                }
            });
        }

        function SearchFilter(pageNum, Filter) {

            $.ajax({
                type: "POST",
                url: '@Url.Action("BindCategoryList", "Category")',
                data: {
                    'pageNo': pageNum,
                    'whereQuery': '',
                    'orderByQuery': searchComp + ' ' + searchOrder,
                    'Search': Filter
                },
                dataType: 'json',
                success: function (data) {
                    if (data.status) {
                        $("#divCategory").html(data.html);
                        $("#divCategoryPaging").html(data.htmlPaging);
                    }

                    $('.iCheck-helper').iCheck({
                        checkboxClass: 'icheckbox_flat-red',
                        radioClass: 'iradio_flat-red'
                    });
                    $('.iCheck-helper').on("click", function () {

                        var CategoryId = $(this).siblings()[0].id.split('_')[1];
                        var CategoryName = $(this).siblings()[0].id.split('_')[2];
                        var Status = $(this).siblings()[0].checked;
                        $('#dynamic_body').html("Are you sure you want to Change the Status of '" + CategoryName + "' Category ?");
                        $('#hdnUpdateId').val(CategoryId);
                        $('#hdnStatus').val(Status);
                        $('#Mdl_UpdateStatus').modal('show');
                    });

                    //$('[data-toggle="tooltip"]').tooltip({ 'placement': 'top' });
                    //$('.tooltips').powerTip();
                    $('.footable').footable({
                        paginate: false
                    });

                    $(window).trigger('resize');

                    $('th.footable-sortable').click(function (e) {
                        if ($(this).hasClass('footable-sorted')) // asc
                        {
                            searchOrder = 'desc'
                        } else {
                            searchOrder = 'asc'
                        }
                        searchComp = $(this)[0].id;
                        SearchFilter(pageNum, Filter);
                    });
                },
                error: function (data) {
                    //$('#dvloader').hide();
                }
            });
        };

    </script>
}